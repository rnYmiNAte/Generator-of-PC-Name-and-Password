name: Generate PC Info & Credentials YAML

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: windows-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Generate PC Name, Username & Password
        shell: pwsh
        run: |
          # Generate PC Name
          $RandomID = Get-Random -Minimum 1000 -Maximum 9999
          $PCName = "WIN-PC-$RandomID"

          # Generate Username
          $Username = "user_$RandomID"

          # Generate Secure Password (12 characters)
          $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()'
          $Password = -join ((1..12) | ForEach-Object { $chars[Get-Random -Maximum $chars.Length] })

          # Prepare YAML content
          $yamlContent = @"
pc_name: $PCName
username: $Username
password: $Password
"@

          # Save YAML file to repo
          $yamlPath = "$PWD/generated_credentials.yml"
          $yamlContent | Out-File -FilePath $yamlPath -Encoding utf8

          echo "Generated YAML file at $yamlPath"

      - name: Show Generated Values
        run: |
          Get-Content "$PWD/generated_credentials.yml"
